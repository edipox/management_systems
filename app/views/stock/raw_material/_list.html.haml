- will_paginate @components
%ul{ data: { role: 'listview', inset: 'true' } }
  %li{ data: { role: 'list-divider'} }
    %div.ui-grid-d
      %div.ui-block-a Componente
      %div.ui-block-b Descripci&oacute;n
      %div.ui-block-c Existencia
      %div.ui-block-d Precio promedio
      %div.ui-block-e Valorizado
  - total_val = 0.0
  - @components.each do |component|
    - stocks = component.raw_material_stocks
    - stock_total = stocks.reduce {|s0, s1| s0.quantity = s0.quantity + s1.quantity; s0 }
    - stock_qty = stock_total.nil? ? 0 : stock_total.quantity
    - price_sum = Stocks::Component.valuation component
    %li
      %div.ui-grid-d
        %div.ui-block-a= component.name
        %div.ui-block-b= component.description
        %div.ui-block-c= stock_qty
        - ppp = stock_qty > 0 ? (price_sum / stock_qty).round(2) : component.price
        - total_val += price_sum # stock_qty > 0 ? ppp : 0
        %div.ui-block-d= ppp
        %div.ui-block-e= (price_sum).round(2)
  
  %li{ data: { role: 'list-divider'} }
    %div
      %label Total valorizado:
      %span= total_val
%br    
%div{ data: { role: 'controlgroup', type: 'horizontal' } }
  %a{ href: "#", data: { role: 'button', mini: 'true', pdf: 'true', href: stock_raw_material_list_url(:format => :pdf) } } Reporte
  
